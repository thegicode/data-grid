"use strict";(()=>{var B=Object.defineProperty,I=Object.defineProperties;var R=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,L=Object.prototype.propertyIsEnumerable;var S=(s,t,e)=>t in s?B(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e,d=(s,t)=>{for(var e in t||(t={}))v.call(t,e)&&S(s,e,t[e]);if(b)for(var e of b(t))L.call(t,e)&&S(s,e,t[e]);return s},M=(s,t)=>I(s,R(t));var x=(s,t)=>{var e={};for(var l in s)v.call(s,l)&&t.indexOf(l)<0&&(e[l]=s[l]);if(s!=null&&b)for(var l of b(s))t.indexOf(l)<0&&L.call(s,l)&&(e[l]=s[l]);return e};var g=(s,t,e)=>new Promise((l,n)=>{var i=a=>{try{r(e.next(a))}catch(c){n(c)}},o=a=>{try{r(e.throw(a))}catch(c){n(c)}},r=a=>a.done?l(a.value):Promise.resolve(a.value).then(i,o);r((e=e.apply(s,t)).next())});var _=[{id:"a-1",name:"name1",description:"description1",quantity:1,food:"food1",vegetable:"vegetable1",option:!0,ref:"ref1"},{id:"a-2",name:"name2",description:"description2",quantity:2,food:"food2",vegetable:"vegetable2",option:!0,ref:"ref2"},{id:"a-3",name:"name3",description:"description3",quantity:3,food:"food3",vegetable:"vegetable3",option:!1,ref:"ref3"},{id:"a-4",name:"name4",description:"description4",quantity:4,food:"food4",vegetable:"vegetable4",option:!1,ref:"ref4"},{id:"a-5",name:"name5",description:"description5",quantity:5,food:"food5",vegetable:"vegetable5",option:!0,ref:"ref5"}];var h=class{constructor(t){this.dataGrid=t,this._selectedCells=new Set,this._currentSelectionRange=[],this._isRangeSelecting=!1,this._rangeSelectingStart=null,this._copiedCells=[]}get selectedCells(){return this._selectedCells}set selectedCells(t){this._selectedCells=t}get currentSelectionRange(){return this._currentSelectionRange}get isRangeSelecting(){return this._isRangeSelecting}set isRangeSelecting(t){this._isRangeSelecting=t}get rangeSelectingStart(){return this._rangeSelectingStart}set rangeSelectingStart(t){this._rangeSelectingStart=t}set copiedCell(t){this._copiedCells=t}get copiedCell(){return this._copiedCells}selectCell(t,e=!1){e||this.clearSelection(),this._selectedCells.add(t),t.classList.add("selected"),t.instance.focus(),t.instance.type==="checkbox"&&(t.instance.readOnly=!1)}moveTo(t,e){var n;let l=(n=this.dataGrid.tbody)==null?void 0:n.querySelector(`td[data-row="${t}"][data-col="${e}"]`);if(l)return this.selectCell(l),l.scrollIntoView({behavior:"smooth",block:"center",inline:"end"}),l.instance.type==="checkbox"&&(l.instance.readOnly=!1),l}selectRange(t,e){var C;let l=parseInt(t.instance.row,10),n=parseInt(t.instance.col,10),i=parseInt(e.instance.row,10),o=parseInt(e.instance.col,10),r=Math.min(l,i),a=Math.max(l,i),c=Math.min(n,o),w=Math.max(n,o);this.clearSelection();let T=[];for(let m=r;m<=a;m++){let y=[];for(let p=c;p<=w;p++){let f=(C=this.dataGrid.tbody)==null?void 0:C.querySelector(`td[data-row="${m}"][data-col="${p}"]`);f&&(this.selectCell(f,!0),y.push(f))}T.push(y)}this._currentSelectionRange=T,this._selectedCells.size>1&&(this.dataGrid.csvButtonVisible=!0)}clearSelection(){this._selectedCells.forEach(e=>{e.classList.remove("selected")}),this._selectedCells.clear();let t=this.dataGrid.querySelector(".selected-th");t&&t.classList.remove("selected-th")}};var E=class{constructor(t=[]){this._records=[];this._records=Array.isArray(t)?[...t]:[]}get records(){return this._records.map(t=>d({},t))}set records(t){Array.isArray(t)?this._records=t.map(e=>d({},e)):console.error("Data must be an array.")}updateFieldValue(t,e,l){let n=this._records.findIndex(i=>i.id===t);n!==-1?(this._records[n]=M(d({},this._records[n]),{[e]:l}),console.log(this.records[n])):console.error(`Record with id: ${t} not found.`)}updateRecordFields(t){let i=t,{id:e}=i,l=x(i,["id"]),n=this._records.findIndex(o=>o.id===e);n!==-1?(this._records[n]=d(d({},this._records[n]),l),console.log(this.records[n])):console.error(`Record with id: ${e} not found.`)}},H=new E;var u=class extends HTMLElement{constructor(){super();this.dataModel=H,this.selection=new h(this),this.table=this.querySelector("table"),this.thead=this.querySelector("thead"),this.tbody=this.querySelector("tbody"),this.csvButton=this.querySelector(".csv-button"),this.dataButton=this.querySelector(".data-button"),this.isComposing=!1}connectedCallback(){return g(this,null,function*(){var e;try{this.dataModel.records=yield this.loadData();let l=["id","name"];this.tableCP=new Table(this,l);let n=(e=this.tbody)==null?void 0:e.querySelector("td");n&&this.selection.selectCell(n),this.bindEvents()}catch(l){console.error("Data loading failed",l)}})}set csvButtonVisible(e){this.csvButton&&(this.csvButton.hidden=!e)}loadData(){return g(this,null,function*(){return new Promise(e=>{setTimeout(()=>{e(_)},100)})})}bindEvents(){document.addEventListener("copy",this.onCopy.bind(this)),document.addEventListener("paste",this.onPaste.bind(this)),this.csvButton&&this.csvButton.addEventListener("click",handleCsvButton.onCsvButtonClick.bind(this,this.selection,this.csvButton)),this.dataButton&&this.dataButton.addEventListener("click",this.onClickShowButton.bind(this)),document.addEventListener("keydown",this.onKeydown.bind(this)),this.addEventListener("click",this.onClickDocument.bind(this))}onKeydown(e){if(e.key==="f"&&(e.ctrlKey||e.metaKey)){e.preventDefault();let l=prompt("Enter text to search:");l&&this.highlightSearchResults(l)}}onCopy(e){e.preventDefault(),clipboard.copyCells(this.selection)}onPaste(e){e.preventDefault(),clipboard.pasteCells(this.table,this.dataModel,this.selection)}onClickShowButton(e){let l=this.querySelector("#data-area pre");l&&(l.textContent=JSON.stringify(this.dataModel.records,null,2))}onClickDocument(e){let l=e.target.closest("td");if(!l)return;l.classList.contains("highlight")||this.clearHighlights()}highlightSearchResults(e){var n;this.clearHighlights();let l=(n=this.tbody)==null?void 0:n.querySelectorAll("td");l==null||l.forEach(i=>{var r;let o=i.instance;(r=o==null?void 0:o.value)!=null&&r.toString().includes(e)&&i.classList.add("highlight")})}clearHighlights(){var l;let e=(l=this.tbody)==null?void 0:l.querySelectorAll(".highlight");e==null||e.forEach(n=>{n.classList.remove("highlight")})}};customElements.define("data-grid",u);})();
//# sourceMappingURL=data-grid.js.map
